name: Deploy to Hugging Face Space

on:
  push:
    branches: ["master"]
  workflow_dispatch:  # å…è®¸æ‰‹åŠ¨è§¦å‘

jobs:
  deploy:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
      
      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.13'
      
      - name: Install uv
        run: |
          curl -LsSf https://astral.sh/uv/install.sh | sh
          echo "$HOME/.cargo/bin" >> $GITHUB_PATH
      
      - name: Export requirements.txt
        run: |
          uv export --no-hashes --no-dev -o requirements.txt
      
      - name: Prepare deployment files
        run: |
          # åˆ›å»ºä¸´æ—¶éƒ¨ç½²ç›®å½•
          mkdir -p /tmp/hf-deploy
          
          # å¤åˆ¶å¿…è¦æ–‡ä»¶åˆ°éƒ¨ç½²ç›®å½•
          cp examples/app.py /tmp/hf-deploy/app.py
          cp requirements.txt /tmp/hf-deploy/
          cp pyproject.toml /tmp/hf-deploy/
          cp -r src /tmp/hf-deploy/
          
          cp LICENSE /tmp/hf-deploy/ || echo "LICENSE not found, skipping"
          
          # åˆ›å»ºå¸¦æœ‰ HF Space é…ç½®çš„ README.md
          cat > /tmp/hf-deploy/README.md << 'EOF'
          ---
          title: Auto Chapter Bar
          emoji: ðŸŽ¬
          colorFrom: blue
          colorTo: purple
          sdk: gradio
          sdk_version: "5.9.1"
          app_file: app.py
          pinned: false
          license: apache-2.0
          ---
          
          # ðŸŽ¬ Auto Chapter Bar
          
          Auto Chapter Barï¼ˆç®€ç§° `acb`ï¼‰æ˜¯ä¸€ä¸ªå¼€æºçš„ Python å·¥å…·ï¼Œå¯ä»¥å¿«é€Ÿå°† SRT å­—å¹•æ–‡ä»¶è½¬æ¢ä¸ºå¸¦æœ‰ Alpha é€æ˜Žé€šé“çš„è§†é¢‘ç« èŠ‚è¿›åº¦æ¡ã€‚
          
          ## âœ¨ æ ¸å¿ƒç‰¹æ€§
          
          - **ðŸŽ¨ é€æ˜Žé€šé“æ”¯æŒ**ï¼šè¾“å‡º RGBA æ ¼å¼ï¼Œå¯å®Œç¾Žå åŠ åœ¨ä»»æ„è§†é¢‘ä¸Š
          - **ðŸ¤– AI æ™ºèƒ½åˆ†æ®µ**ï¼šåŸºäºŽ Moonshot LLM ç†è§£è¯­ä¹‰è¾¹ç•Œï¼Œè‡ªåŠ¨è¯†åˆ«ç« èŠ‚
          - **ðŸ”’ éšç§ä¼˜å…ˆ**ï¼šå®Œå…¨æœ¬åœ°å¤„ç†ï¼Œè§†é¢‘æ–‡ä»¶ä¸ä¸Šä¼ äº‘ç«¯
          - **âš¡ é«˜æ€§èƒ½**ï¼šå¤šè¿›ç¨‹å¹¶è¡Œå¤„ç†ï¼Œé€Ÿåº¦æå‡ 2-4 å€
          - **ðŸŽ›ï¸ ä¸‰ç§æ¨¡å¼**ï¼šAI æ™ºèƒ½æ¨¡å¼ã€è‡ªåŠ¨åˆ†æ®µæ¨¡å¼ã€æ‰‹åŠ¨é…ç½®æ¨¡å¼
          
          ## ðŸš€ ä½¿ç”¨æ–¹æ³•
          
          1. ä¸Šä¼  SRT å­—å¹•æ–‡ä»¶
          2. è¾“å…¥è§†é¢‘æ€»æ—¶é•¿ï¼ˆç§’ï¼‰
          3. é€‰æ‹©ç”Ÿæˆæ¨¡å¼ï¼ˆAI æˆ– Autoï¼‰
          4. ç‚¹å‡»ç”ŸæˆæŒ‰é’®
          5. ä¸‹è½½ç”Ÿæˆçš„ç« èŠ‚è¿›åº¦æ¡è§†é¢‘
          
          ## ðŸ“¦ åœ¨è§†é¢‘ç¼–è¾‘è½¯ä»¶ä¸­ä½¿ç”¨
          
          ç”Ÿæˆçš„è§†é¢‘å¸¦æœ‰é€æ˜Žé€šé“ï¼ˆAlpha Channelï¼‰ï¼Œå¯ä»¥ç›´æŽ¥å åŠ åœ¨åŽŸè§†é¢‘ä¸Šï¼š
          
          - **Adobe Premiere Pro**ï¼šå¯¼å…¥åŽæ”¾åœ¨æœ€ä¸Šå±‚è§†é¢‘è½¨é“
          - **å‰ªæ˜ ï¼ˆCapCutï¼‰**ï¼šæ·»åŠ ä¸ºç”»ä¸­ç”»è½¨é“
          - **DaVinci Resolve**ï¼šæ”¾åœ¨è§†é¢‘è½¨é“æœ€ä¸Šå±‚
          
          ## ðŸ”— é¡¹ç›®é“¾æŽ¥
          
          - **GitHub**: https://github.com/bbruceyuan/auto-chapter-bar
          - **æ–‡æ¡£**: æŸ¥çœ‹ GitHub ä»“åº“èŽ·å–å®Œæ•´æ–‡æ¡£
          - **è®¸å¯è¯**: Apache License 2.0
          
          ---
          
          â­ å¦‚æžœè§‰å¾—è¿™ä¸ªé¡¹ç›®æœ‰å¸®åŠ©ï¼Œè¯·åœ¨ GitHub ç»™ä¸ª Starï¼
          EOF
          
          # åˆ›å»º .gitignore for HF Space
          cat > /tmp/hf-deploy/.gitignore << 'EOF'
          __pycache__/
          *.py[cod]
          .venv/
          *.mov
          *.mp4
          outputs/
          inputs/
          EOF
      
      - name: Push to Hugging Face Space
        env:
          HF_TOKEN: ${{ secrets.HF_TOKEN }}
          HF_USERNAME: bbruceyuan
          HF_SPACE_NAME: auto-chapter-bar
        run: |
          cd /tmp/hf-deploy
          
          # é…ç½® git
          git config --global user.email "github-actions[bot]@users.noreply.github.com"
          git config --global user.name "github-actions[bot]"
          
          # åˆå§‹åŒ– git ä»“åº“
          git init
          git checkout -b main
          
          # æ·»åŠ æ‰€æœ‰æ–‡ä»¶
          git add .
          git commit -m "Deploy from GitHub Actions - $(date +'%Y-%m-%d %H:%M:%S')"
          
          # æŽ¨é€åˆ° Hugging Face
          git remote add hf https://${HF_USERNAME}:${HF_TOKEN}@huggingface.co/spaces/${HF_USERNAME}/${HF_SPACE_NAME}
          git push -f hf main
